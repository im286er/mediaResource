<!DOCTYPE html>
<html >
<head>
	<meta charset="UTF-8">
	<title>注册页面</title>
	<link rel="stylesheet" href="__STATIC__/css/common.css">
	<link rel="stylesheet" href="__STATIC__/css/login.css">
	<link rel="stylesheet" href="__STATIC__/css/buttons.css">
	<script type="text/javascript"
	src="__STATIC__/js/jquery-2.2.2.min.js"></script>
</head>
<body>
	<div class="login">
		<h1>注册</h1>
		<div id="registerForm"> 
			<div class='ub'><div class="umw100 upad5">用户名:</div><input type="text" name="username" id="username" placeholder="请输入手机号或者邮箱" required="required" /></div>
			<div class='ub'><div class="umw100 upad5">验证码：</div><input type="text" name="code"  id="code" placeholder="请输入验证码" required="required"  style="width: 65%;" /></div>
			<div class='ub'><div class="umw100 upad5">密码：</div><input type="password" name="password"  id="password" placeholder="请输入密码" required="required" /></div>
			<div class='ub'><div class="umw100 upad5">确认密码：</div><input type="password" name="password2" id="password2" placeholder="请再次输入密码" required="required" /></div>
			<!-- 		<div class='ub'><div class="umw100 upad5">邮箱：</div><input type="email" name="email" id="email" placeholder="请输入邮箱" required="required" /></div> -->
			<div class='ub'><div class="umw100 upad5">昵称：</div><input type="text" name="nickname" id="nickname" placeholder="请输入昵称" required="required" /></div>
			<div class='hint umar-t20'></div>
			<div class="ub ub-ac ub-pc umar-t20"><div class="button button-raised button-primary button-pill button-large w350 " id="registerBtn">注册</div></div>			
		</div>
	</div>
	<div class="button button-primary button-pill" id="getCode" style="width: 140px;height:40px;position: absolute;top:36.5%;left: 54%;font-size: 10px;" data-type="0">获取验证码</div>
</body>
<script type="text/javascript">
	$(function() {
		//手机号正则表达式
		var reg=/^1[3|4|5|7|8]\d{9}$/;
		//邮箱正则表达式
		var reg2=/[a-zA-Z0-9]{1,10}@[a-zA-Z0-9]{1,5}\.[a-zA-Z0-9]{1,5}/;
		$("#registerBtn").click(function() {
			var username=$("#username").val();
			var password=$("#password").val();
			var password2=$("#password2").val();
			var email=$("#email").val();
			var nickname=$("#nickname").val();
			if(username==''){
				$(".hint").text("请输入手机号或者邮箱!");
				return;
			}
			if(username!=''&&!reg.test(username)&&!reg2.test(username)){
				$(".hint").text("请输入有效手机号或者邮箱!");
				return;
			}  
			if(password==''){
				$(".hint").text("请输入密码!");
				return;
			}
			if(password2==''){
				$(".hint").text("请确认密码!");
				return;
			}
			if(password!=password2){
				$(".hint").text("两次输入密码不一致!");
				return;
			}
			if(email==''){
				$(".hint").text("请输入邮箱!");
				return;
			}
			if(email!=''&&!reg2.test(email)){
				$(".hint").text("请正确填写邮箱!");
				return;
			}  
			if(nickname==''){
				$(".hint").text("请确认昵称!");
				return;
			}
			$.post("{:U('User/register')}", {
				username : username,
				password:password,
				email:email,
				nickname:nickname
			}, function(data) {
				console.log(data);
				var status=data.status;
				var info=data.info;
				if(status==1){
					//注册成功时
					$(".hint").text("注册成功，即将转向登陆页面");
					setInterval('window.location.href="__MODULE__/User/loginPage"',3000);
				}
				else{
					$(".hint").text(info);
				}
			}
			);
		})
		
		//清空提示
		function clean(){
			$(".hint").text('');
		}
		//绑定事件-任何输入都清空提示
		var $username=$("#username");
		var $password=$("#password");
		var $password2=$("#password2");
		var $email=$("#email");
		var $nickname=$("#nickname");
		var $code=$("#code");

		//获取验证码
		$("#getCode").click(function(){
			var dtype=$("#getCode").attr("data-type");
			if($username.val()==""){
				$(".hint").text("请先输入手机号或者邮箱账号!");
			}
			else{
				if(dtype==0){
					$(".hint").text("请先输入有效手机号或者邮箱账号!");
				}
				else{
					//获取验证码
				}
			}
		})

		$username.on('input',function(){
			$(".hint").text('');
			$("#getCode").attr("data-type","0");
			$("#getCode").text("获取验证码");
			var username=$("#username").val();
			if(reg.test(username)){
				$("#getCode").attr("data-type","1");
				$("#getCode").text("手机验证码");
			}
			if(reg2.test(username)){
				$("#getCode").attr("data-type","2");
				$("#getCode").text("邮箱验证码");
			}
		});
		$password.on('input',clean);
		$password2.on('input',clean);
		$email.on('input',clean);
		$nickname.on('input',clean);	
		$code.on('input',clean);	
	})
</script>
</html>
