<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>忘记密码</title>
	<link rel="stylesheet" href="__STATIC__/css/common.css">
	<link rel="stylesheet" href="__STATIC__/css/login.css">
	<link rel="stylesheet" href="__STATIC__/css/buttons.css">
	<script type="text/javascript"
	src="__STATIC__/js/jquery-2.2.2.min.js"></script>
</head>
<body>
	<div class="login">
		<h1>忘记密码</h1>
		<div id="resetForm"></div>
		<div class='ub'>
			<div class="umw100 upad5">手机号:</div>
			<input type="text" name="username" placeholder="请输入手机号"
			required="required" id="username" />
		</div>
		<div class='ub'>
			<div class="umw100 upad5">邮箱:</div>
			<input type="text" name="email" placeholder="请输入邮箱"
			required="required" id="email" />
		</div>
		<div class='ub'>
			<div class="umw100 upad5">新密码:</div>
			<input type="password" name="password" placeholder="请输入新密码"
			required="required" id="password" />
		</div>
		<div class='ub'>
			<div class="umw100 upad5">确认新密码:</div>
			<input type="password" name="password2" placeholder="请再次输入新密码"
			required="required" id="password2" />
		</div>
		<div class='hint umar-t20'></div>
		<div class="ub ub-ac ub-pc"><div class="button button-raised button-primary button-pill button-large w350" id="resetBtn">重置密码</div></div>
	</div>
</div>
</body>
<script type="text/javascript">
	$(function() {
		//手机号正则表达式
		var reg = /^1[3|4|5|8][0-9]\d{4,8}$/;
		//邮箱正则表达式
		var reg2 = /[a-zA-Z0-9]{1,10}@[a-zA-Z0-9]{1,5}\.[a-zA-Z0-9]{1,5}/;
		$("#resetBtn").click(function() {
			var username = $("#username").val();
			var password = $("#password").val();
			var password2 = $("#password2").val();
			var email = $("#email").val();
			if (username == '') {
				$(".hint").text("请先输入手机号!");
				return;
			}
			if (username != '' && !reg.test(username)) {
				$(".hint").text("请输入有效手机号!");
				return;
			}
			if (password == '') {
				$(".hint").text("请输入密码!");
				return;
			}
			if (password2 == '') {
				$(".hint").text("请确认密码!");
				return;
			}
			if (password != password2) {
				$(".hint").text("两次输入密码不一致!");
				return;
			}
			if (email == '') {
				$(".hint").text("请输入邮箱!");
				return;
			}
			if (email != '' && !reg2.test(email)) {
				$(".hint").text("请正确填写邮箱!");
				return;
			}
			//发送请求
			$.post("{:U('User/resetPwd')}", {
				username : username,
				email : email,
				password : password,
			}, function(data) {
				console.log(data);
				var status = data.status;
				var info = data.info;
				if (status == 1) {
					//重置成功时
					$(".hint").text(info);
				} else {
					$(".hint").text(info);
				}
			});
		})

		//清空提示
		function clean() {
			$(".hint").text('');
		}
		//绑定事件-任何输入都清空提示
		var $username = $("#username");
		var $password = $("#password");
		var $password2 = $("#password2");
		var $email = $("#email");
		$username.on('input', clean);
		$password.on('input', clean);
		$password2.on('input', clean);
		$email.on('input', clean);
	})
</script>
</html>